<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xray Config Generator (UI Style)</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Vue –∏ Ant Design (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –ø–∞–Ω–µ–ª–∏) -->
    <link href="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.js"></script>
    <!-- –î–ª—è Drag-and-Drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.10.2/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuedraggable@2.24.3/dist/vuedraggable.umd.min.js"></script>
    
    <style>
        body { background-color: #141414; color: #e0e0e0; font-family: sans-serif; }
        #app { padding: 20px; max-width: 1400px; margin: 0 auto; }
        
        /* Dark Theme Overrides mimicking X-UI */
        .ant-layout, .ant-layout-sider, .ant-menu, .ant-card { background: #1f1f1f !important; color: white !important; }
        .ant-input, .ant-select-selection, .ant-input-number-input { background-color: #2a2a2a !important; border-color: #434343 !important; color: white !important; }
        .ant-select-dropdown { background-color: #2a2a2a !important; }
        .ant-select-dropdown-menu-item { color: white !important; }
        .ant-select-dropdown-menu-item-selected { background-color: #1890ff !important; }
        .ant-tabs-bar { border-bottom: 1px solid #303030 !important; }
        .ant-tabs-tab { color: #a6a6a6 !important; }
        .ant-tabs-tab-active { color: #1890ff !important; }
        
        /* Custom List for Drag and Drop */
        .rule-item {
            background: #2a2a2a;
            border: 1px solid #434343;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: move;
        }
        .rule-item:hover { border-color: #1890ff; }
        .ghost-class { opacity: 0.5; background: #1890ff; }
        
        .json-preview {
            background: #101010;
            color: #a6e3a1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            height: 600px;
            width: 100%;
            border: 1px solid #333;
            resize: vertical;
        }
    </style>
</head>
<body>

<div id="app">
    <a-layout style="min-height: 100vh;">
        <a-layout-content>
            <a-card title="üõ† Xray Config Generator" :bordered="false">
                <a-tabs default-active-key="1">
                    
                    <!-- TAB 1: INBOUNDS -->
                    <a-tab-pane key="1" tab="üì• Inbounds">
                        <a-button type="primary" icon="plus" @click="addInbound" style="margin-bottom: 15px;">–î–æ–±–∞–≤–∏—Ç—å Inbound</a-button>
                        
                        <a-collapse v-if="inbounds.length > 0">
                            <a-collapse-panel v-for="(inb, index) in inbounds" :key="index" :header="inb.tag + ' (' + inb.protocol + ':' + inb.port + ')'">
                                <a-icon slot="extra" type="delete" style="color: red" @click.stop="removeInbound(index)"></a-icon>
                                
                                <a-form-model layout="vertical">
                                    <a-row :gutter="16">
                                        <a-col :span="6">
                                            <a-form-model-item label="Tag">
                                                <a-input v-model="inb.tag" />
                                            </a-form-model-item>
                                        </a-col>
                                        <a-col :span="6">
                                            <a-form-model-item label="Port">
                                                <a-input-number v-model="inb.port" style="width: 100%" />
                                            </a-form-model-item>
                                        </a-col>
                                        <a-col :span="6">
                                            <a-form-model-item label="Protocol">
                                                <a-select v-model="inb.protocol" @change="updateInboundDefaults(inb)">
                                                    <a-select-option value="vless">VLESS</a-select-option>
                                                    <a-select-option value="vmess">VMess</a-select-option>
                                                    <a-select-option value="trojan">Trojan</a-select-option>
                                                    <a-select-option value="shadowsocks">Shadowsocks</a-select-option>
                                                    <a-select-option value="dokodemo-door">Dokodemo</a-select-option>
                                                </a-select>
                                            </a-form-model-item>
                                        </a-col>
                                    </a-row>

                                    <!-- Auth / UUID -->
                                    <a-form-model-item :label="inb.protocol === 'trojan' || inb.protocol === 'shadowsocks' ? 'Password' : 'UUID'">
                                        <a-input v-model="inb.uuid">
                                            <a-icon slot="addonAfter" type="reload" style="cursor:pointer" @click="inb.uuid = generateUUID()" />
                                        </a-input>
                                    </a-form-model-item>

                                    <!-- Stream Settings -->
                                    <a-card size="small" title="Stream Settings" style="background: #262626; border: 1px solid #444;">
                                        <a-row :gutter="16">
                                            <a-col :span="8">
                                                <a-form-model-item label="Network">
                                                    <a-select v-model="inb.network">
                                                        <a-select-option value="tcp">TCP</a-select-option>
                                                        <a-select-option value="ws">WebSocket</a-select-option>
                                                        <a-select-option value="grpc">gRPC</a-select-option>
                                                    </a-select>
                                                </a-form-model-item>
                                            </a-col>
                                            <a-col :span="8">
                                                <a-form-model-item label="Security">
                                                    <a-select v-model="inb.security">
                                                        <a-select-option value="none">None</a-select-option>
                                                        <a-select-option value="tls">TLS</a-select-option>
                                                        <a-select-option value="reality">Reality</a-select-option>
                                                    </a-select>
                                                </a-form-model-item>
                                            </a-col>
                                            
                                            <!-- Flow for VLESS+TLS/Reality -->
                                            <a-col :span="8" v-if="inb.protocol === 'vless' && (inb.security === 'tls' || inb.security === 'reality')">
                                                <a-form-model-item label="Flow">
                                                    <a-select v-model="inb.flow">
                                                        <a-select-option value="">None</a-select-option>
                                                        <a-select-option value="xtls-rprx-vision">xtls-rprx-vision (Vision)</a-select-option>
                                                    </a-select>
                                                </a-form-model-item>
                                            </a-col>
                                        </a-row>

                                        <!-- Reality Specific -->
                                        <div v-if="inb.security === 'reality'">
                                            <a-divider style="border-color: #444; color: #1890ff; font-size: 12px;">Reality Settings</a-divider>
                                            <a-row :gutter="16">
                                                <a-col :span="12"><a-form-model-item label="Dest"><a-input v-model="inb.realityDest" /></a-form-model-item></a-col>
                                                <a-col :span="12"><a-form-model-item label="SNI"><a-input v-model="inb.realitySni" /></a-form-model-item></a-col>
                                                <a-col :span="16"><a-form-model-item label="Private Key"><a-input v-model="inb.realityKey" /></a-form-model-item></a-col>
                                                <a-col :span="8"><a-form-model-item label="ShortIds"><a-input v-model="inb.realityShortId" /></a-form-model-item></a-col>
                                            </a-row>
                                        </div>
                                    </a-card>
                                </a-form-model>
                            </a-collapse-panel>
                        </a-collapse>
                        <a-empty v-else description="–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π" />
                    </a-tab-pane>

                    <!-- TAB 2: OUTBOUNDS -->
                    <a-tab-pane key="2" tab="üì§ Outbounds">
                        <a-button type="primary" icon="plus" @click="addOutbound" style="margin-bottom: 15px;">–î–æ–±–∞–≤–∏—Ç—å Outbound</a-button>
                         <draggable v-model="outbounds" handle=".drag-handle" ghost-class="ghost-class">
                            <div v-for="(out, index) in outbounds" :key="index" class="rule-item">
                                <a-icon type="menu" class="drag-handle" style="margin-right: 10px; cursor: move;"></a-icon>
                                <div style="flex: 1; display:flex; gap: 10px;">
                                    <a-input v-model="out.tag" placeholder="Tag" style="width: 150px;" />
                                    <a-select v-model="out.protocol" style="width: 150px;">
                                        <a-select-option value="freedom">Freedom (Direct)</a-select-option>
                                        <a-select-option value="blackhole">Blackhole (Block)</a-select-option>
                                        <a-select-option value="wireguard">WireGuard</a-select-option>
                                        <a-select-option value="socks">Socks</a-select-option>
                                        <a-select-option value="vless">VLESS</a-select-option>
                                    </a-select>
                                </div>
                                <a-button type="danger" shape="circle" icon="delete" size="small" @click="outbounds.splice(index, 1)"></a-button>
                            </div>
                        </draggable>
                    </a-tab-pane>

                    <!-- TAB 3: ROUTING -->
                    <a-tab-pane key="3" tab="üîÄ Routing">
                        <a-alert message="–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞, —á—Ç–æ–±—ã –º–µ–Ω—è—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (—Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑)" banner style="margin-bottom: 10px;" />
                        <a-button type="dashed" block @click="addRule" style="margin-bottom: 15px;">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ</a-button>

                        <draggable v-model="rules" handle=".drag-handle" ghost-class="ghost-class">
                            <transition-group>
                                <div v-for="(rule, index) in rules" :key="rule.id" class="rule-item">
                                    <div style="display:flex; align-items:center; width: 100%;">
                                        <a-icon type="menu" class="drag-handle" style="margin-right: 15px; font-size: 18px; color: #888;"></a-icon>
                                        
                                        <div style="flex: 1;">
                                            <a-row :gutter="10" style="margin-bottom: 5px;">
                                                <a-col :span="18">
                                                    <span style="color: #888; font-size: 12px;">Domain / IP</span>
                                                    <a-textarea v-model="rule.content" :rows="1" placeholder="geosite:google, geoip:ru" style="resize: none; background: #1f1f1f;" />
                                                </a-col>
                                                <a-col :span="6">
                                                    <span style="color: #888; font-size: 12px;">Target Tag</span>
                                                    <a-select v-model="rule.outboundTag" style="width: 100%;">
                                                        <a-select-option v-for="out in outbounds" :key="out.tag" :value="out.tag">
                                                            {{ out.tag }}
                                                        </a-select-option>
                                                    </a-select>
                                                </a-col>
                                            </a-row>
                                            <a-checkbox-group v-model="rule.type" :options="['domain', 'ip']" />
                                        </div>
                                        
                                        <a-button type="link" icon="close" style="color: #ff4d4f" @click="rules.splice(index, 1)"></a-button>
                                    </div>
                                </div>
                            </transition-group>
                        </draggable>
                    </a-tab-pane>

                    <!-- TAB 4: JSON RESULT -->
                    <a-tab-pane key="4" tab="üíæ Config JSON">
                        <div style="margin-bottom: 10px; display: flex; justify-content: flex-end;">
                            <a-button type="primary" icon="copy" @click="copyJson">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</a-button>
                        </div>
                        <textarea class="json-preview" readonly>{{ finalConfig }}</textarea>
                    </a-tab-pane>

                </a-tabs>
            </a-card>
        </a-layout-content>
    </a-layout>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            inbounds: [
                { 
                    tag: 'in-vless', protocol: 'vless', port: 443, uuid: '', 
                    network: 'tcp', security: 'reality', flow: 'xtls-rprx-vision',
                    realityDest: 'www.microsoft.com:443', realitySni: 'www.microsoft.com', realityKey: '', realityShortId: '' 
                }
            ],
            outbounds: [
                { tag: 'direct', protocol: 'freedom' },
                { tag: 'block', protocol: 'blackhole' }
            ],
            rules: [
                { id: 1, type: ['domain'], content: 'geosite:category-ads-all', outboundTag: 'block' },
                { id: 2, type: ['ip'], content: 'geoip:private', outboundTag: 'block' },
                { id: 3, type: ['domain', 'ip'], content: 'geosite:cn, geoip:cn', outboundTag: 'direct' }
            ]
        },
        mounted() {
            this.inbounds[0].uuid = this.generateUUID();
        },
        computed: {
            finalConfig() {
                const config = {
                    log: { loglevel: "warning" },
                    inbounds: this.inbounds.map(this.transformInbound),
                    outbounds: this.outbounds.map(this.transformOutbound),
                    routing: {
                        domainStrategy: "IPIfNonMatch",
                        rules: this.rules.map(this.transformRule)
                    }
                };
                return JSON.stringify(config, null, 2);
            }
        },
        methods: {
            addInbound() {
                this.inbounds.push({
                    tag: 'in-' + Math.floor(Math.random() * 1000),
                    protocol: 'vless',
                    port: 443,
                    uuid: this.generateUUID(),
                    network: 'tcp',
                    security: 'none',
                    flow: '',
                    realityDest: 'www.google.com:443',
                    realitySni: 'www.google.com',
                    realityKey: '',
                    realityShortId: ''
                });
            },
            removeInbound(index) {
                this.$confirm({
                    title: '–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç Inbound?',
                    onOk: () => this.inbounds.splice(index, 1)
                });
            },
            addOutbound() {
                this.outbounds.push({ tag: 'proxy', protocol: 'vless' });
            },
            addRule() {
                this.rules.unshift({
                    id: Date.now(),
                    type: ['domain'],
                    content: '',
                    outboundTag: 'block'
                });
            },
            updateInboundDefaults(inb) {
                if (inb.protocol === 'trojan' || inb.protocol === 'shadowsocks') {
                    inb.uuid = "password"; 
                } else {
                    inb.uuid = this.generateUUID();
                }
            },
            generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            },
            // --- TRANSFORMERS (Data to Xray JSON) ---
            transformInbound(i) {
                let obj = {
                    tag: i.tag,
                    port: i.port,
                    protocol: i.protocol,
                    settings: {},
                    streamSettings: {
                        network: i.network,
                        security: i.security,
                        tcpSettings: {},
                        wsSettings: {},
                        grpcSettings: {}
                    },
                    sniffing: { enabled: true, destOverride: ["http", "tls", "quic"], routeOnly: true }
                };

                // Clients
                if (i.protocol === 'vless') {
                    obj.settings.clients = [{ id: i.uuid, flow: i.flow }];
                    obj.settings.decryption = "none";
                } else if (i.protocol === 'vmess') {
                    obj.settings.clients = [{ id: i.uuid, alterId: 0 }];
                } else if (i.protocol === 'trojan') {
                    obj.settings.clients = [{ password: i.uuid }];
                } else if (i.protocol === 'shadowsocks') {
                    obj.settings.password = i.uuid;
                    obj.settings.method = "aes-256-gcm";
                    obj.settings.network = "tcp,udp";
                }

                // Stream
                if (i.security === 'reality') {
                    obj.streamSettings.realitySettings = {
                        show: false,
                        dest: i.realityDest,
                        xver: 0,
                        serverNames: [i.realitySni],
                        privateKey: i.realityKey,
                        shortIds: i.realityShortId ? [i.realityShortId] : [""]
                    };
                } else if (i.security === 'tls') {
                    obj.streamSettings.tlsSettings = { serverName: i.realitySni }; // using same field for SNI
                }

                return obj;
            },
            transformOutbound(o) {
                let obj = { tag: o.tag, protocol: o.protocol };
                if (o.protocol === 'wireguard') {
                    obj.settings = { secretKey: "YOUR_KEY", peers: [{ endpoint: "1.1.1.1:2408", publicKey: "KEY" }] };
                }
                return obj;
            },
            transformRule(r) {
                let rule = { type: "field", outboundTag: r.outboundTag };
                const items = r.content.split(',').map(s => s.trim()).filter(s => s);
                
                if (r.type.includes('domain')) rule.domain = items;
                if (r.type.includes('ip')) rule.ip = items;
                
                // If mixed content in one field, heuristic split (simplified)
                if (items.length > 0 && !rule.domain && !rule.ip) {
                     // Default fallback logic if checkboxes failed
                     rule.domain = items;
                }
                return rule;
            },
            copyJson() {
                navigator.clipboard.writeText(this.finalConfig);
                this.$message.success('–ö–æ–Ω—Ñ–∏–≥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
            }
        }
    });
</script>

</body>
</html>
